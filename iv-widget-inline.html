<div class="iv-wrap" id="iv-wrap">
  <div class="iv-head">
    <h2>Valutazione smart del tuo immobile</h2>
    <p class="iv-sub">Rispondi a poche domande. La stima si aggiorna in tempo reale.</p>
  </div>

  <div class="iv-layout">
    <form id="iv-form" class="iv-form" novalidate>
      <div class="iv-progress">
        <div class="iv-progress-top">
          <span class="iv-progress-label">Step <span id="iv-step-num">1</span> di <span id="iv-step-total">6</span></span>
          <span class="iv-progress-hint" id="iv-step-hint">Dove si trova l'immobile?</span>
        </div>
        <div class="iv-progress-bar"><div class="iv-progress-fill" id="iv-progress-fill"></div></div>
      </div>

      <div class="iv-step" data-step="1">
        <div class="iv-grid">
          <div class="iv-field iv-full">
            <label for="iv-address">Indirizzo *</label>
            <input id="iv-address" name="address" required />
            <div class="iv-err"></div>
          </div>
          <div class="iv-field">
            <label for="iv-city">Citta *</label>
            <input id="iv-city" name="city" required />
            <div class="iv-err"></div>
          </div>
          <div class="iv-field">
            <label for="iv-cap">CAP</label>
            <input id="iv-cap" name="cap" />
            <div class="iv-err"></div>
          </div>
        </div>
        <div class="iv-actions">
          <button type="button" class="iv-btn iv-next">Avanti</button>
        </div>
      </div>

      <div class="iv-step" data-step="2" style="display:none;">
        <div class="iv-grid">
          <div class="iv-field">
            <label for="iv-type">Tipologia *</label>
            <div class="iv-select">
              <select id="iv-type" name="type" required>
                <option value="">Seleziona...</option>
                <option value="appartamento">Appartamento</option>
                <option value="attico">Attico</option>
                <option value="villa">Villa</option>
                <option value="casa-indipendente">Casa indipendente</option>
                <option value="bifamiliare">Bifamiliare / Schiera</option>
                <option value="loft">Loft</option>
                <option value="ufficio">Ufficio</option>
                <option value="negozio">Negozio</option>
                <option value="altro">Altro</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-mq">Superficie (mq) *</label>
            <input id="iv-mq" name="sqm" type="number" min="10" required />
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-rooms">Locali</label>
            <input id="iv-rooms" name="rooms" type="number" min="1" />
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-baths">Bagni</label>
            <input id="iv-baths" name="baths" type="number" min="0" />
            <div class="iv-err"></div>
          </div>

          <div class="iv-field iv-full">
            <label for="iv-area-quality">Zona</label>
            <div class="iv-select">
              <select id="iv-area-quality" name="area_quality">
                <option value="">Seleziona...</option>
                <option value="centrale">Centrale</option>
                <option value="semicentrale">Semicentrale</option>
                <option value="periferica">Periferica</option>
                <option value="frazione">Frazione / Localita esterna</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>
        </div>
        <div class="iv-actions">
          <button type="button" class="iv-link iv-back">&larr; Indietro</button>
          <button type="button" class="iv-btn iv-next">Avanti</button>
        </div>
      </div>

      <div class="iv-step" data-step="3" style="display:none;">
        <div class="iv-grid">
          <div class="iv-field">
            <label for="iv-year">Anno costruzione</label>
            <input id="iv-year" name="year" type="number" min="1600" max="2035" />
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-condition">Stato immobile</label>
            <div class="iv-select">
              <select id="iv-condition" name="condition">
                <option value="">Seleziona...</option>
                <option value="nuovo">Nuovo / Ristrutturato</option>
                <option value="buono">Buono</option>
                <option value="da-ristrutturare">Da ristrutturare</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-building-condition">Stato edificio</label>
            <div class="iv-select">
              <select id="iv-building-condition" name="building_condition">
                <option value="">Seleziona...</option>
                <option value="ottimo">Ottimo</option>
                <option value="buono">Buono</option>
                <option value="da_aggiornare">Da aggiornare</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-energy">Classe energetica</label>
            <div class="iv-select">
              <select id="iv-energy" name="energy">
                <option value="">Seleziona...</option>
                <option value="A4">A4</option><option value="A3">A3</option><option value="A2">A2</option><option value="A1">A1</option>
                <option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option>
                <option value="E">E</option><option value="F">F</option><option value="G">G</option><option value="ND">ND</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-floor">Piano</label>
            <div class="iv-select">
              <select id="iv-floor" name="floor">
                <option value="">Seleziona...</option>
                <option value="t">Terra</option>
                <option value="1">1</option><option value="2">2</option><option value="3">3</option>
                <option value="4">4</option><option value="5">5</option><option value="6">6+</option>
                <option value="m">Mansarda</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-occupancy">Disponibilita</label>
            <div class="iv-select">
              <select id="iv-occupancy" name="occupancy">
                <option value="">Seleziona...</option>
                <option value="libero_subito">Libero subito</option>
                <option value="libero_rogito">Libero al rogito</option>
                <option value="locato">Locato</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>

          <div class="iv-field iv-full">
            <div class="iv-checkrow">
              <label class="iv-check"><input type="checkbox" name="elevator" /><span>Ascensore</span></label>
              <label class="iv-check"><input type="checkbox" name="furnished" /><span>Arredato</span></label>
              <label class="iv-check"><input type="checkbox" name="ac" /><span>Climatizzazione</span></label>
            </div>
          </div>
        </div>
        <div class="iv-actions">
          <button type="button" class="iv-link iv-back">&larr; Indietro</button>
          <button type="button" class="iv-btn iv-next">Avanti</button>
        </div>
      </div>

      <div class="iv-step" data-step="4" style="display:none;">
        <div class="iv-grid">
          <div class="iv-field">
            <label for="iv-heating">Riscaldamento</label>
            <div class="iv-select">
              <select id="iv-heating" name="heating">
                <option value="">Seleziona...</option>
                <option value="autonomo">Autonomo</option>
                <option value="centralizzato">Centralizzato</option>
                <option value="pompa-calore">Pompa di calore</option>
                <option value="teleriscaldamento">Teleriscaldamento</option>
                <option value="stufa">Stufa</option>
                <option value="pavimento">Pavimento</option>
                <option value="assente">Assente</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-parking">Posto auto / Garage</label>
            <div class="iv-select">
              <select id="iv-parking" name="parking">
                <option value="">Seleziona...</option>
                <option value="nessuno">Nessuno</option>
                <option value="posto-auto">Posto auto</option>
                <option value="garage">Garage</option>
                <option value="posto-auto+garage">Posto auto + Garage</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>

          <div class="iv-field" id="iv-parking-sqm-field" style="display:none;">
            <label for="iv-parking-sqm" id="iv-parking-sqm-label">Mq garage/posto auto</label>
            <input id="iv-parking-sqm" name="parking_sqm" type="number" min="1" />
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-outdoor">Spazi esterni</label>
            <div class="iv-select">
              <select id="iv-outdoor" name="outdoor">
                <option value="">Seleziona...</option>
                <option value="nessuno">Nessuno</option>
                <option value="balcone">Balcone</option>
                <option value="terrazzo">Terrazzo</option>
                <option value="giardino">Giardino</option>
                <option value="balcone+giardino">Balcone + Giardino</option>
                <option value="terrazzo+giardino">Terrazzo + Giardino</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>

          <div class="iv-field" id="iv-outdoor-sqm-field" style="display:none;">
            <label for="iv-outdoor-sqm" id="iv-outdoor-sqm-label">Mq spazi esterni</label>
            <input id="iv-outdoor-sqm" name="outdoor_sqm" type="number" min="1" />
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-exposure">Esposizione</label>
            <div class="iv-select">
              <select id="iv-exposure" name="exposure">
                <option value="">Seleziona...</option>
                <option value="n">Nord</option>
                <option value="s">Sud</option>
                <option value="e">Est</option>
                <option value="o">Ovest</option>
                <option value="ne">Nord/Est</option>
                <option value="no">Nord/Ovest</option>
                <option value="se">Sud/Est</option>
                <option value="so">Sud/Ovest</option>
                <option value="doppia">Doppia</option>
                <option value="tripla">Tripla</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-noise">Rumorosita zona</label>
            <div class="iv-select">
              <select id="iv-noise" name="noise">
                <option value="">Seleziona...</option>
                <option value="silenziosa">Silenziosa</option>
                <option value="normale">Normale</option>
                <option value="trafficata">Trafficata</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>

          <div class="iv-field">
            <label for="iv-brightness">Luminosita</label>
            <div class="iv-select">
              <select id="iv-brightness" name="brightness">
                <option value="">Seleziona...</option>
                <option value="alta">Alta</option>
                <option value="media">Media</option>
                <option value="bassa">Bassa</option>
              </select>
            </div>
            <div class="iv-err"></div>
          </div>

          <div class="iv-field iv-full">
            <div class="iv-checkrow">
              <label class="iv-check"><input type="checkbox" name="cellar" /><span>Cantina / Solaio</span></label>
              <label class="iv-check"><input type="checkbox" name="solar" /><span>Pannelli solari</span></label>
              <label class="iv-check"><input type="checkbox" name="view" /><span>Vista aperta</span></label>
            </div>
          </div>

          <div class="iv-field iv-full">
            <label for="iv-notes">Note aggiuntive</label>
            <textarea id="iv-notes" name="notes"></textarea>
            <div class="iv-err"></div>
          </div>
        </div>
        <div class="iv-actions">
          <button type="button" class="iv-link iv-back">&larr; Indietro</button>
          <button type="button" class="iv-btn iv-next">Avanti</button>
        </div>
      </div>

      <div class="iv-step" data-step="5" style="display:none;">
        <div class="iv-grid">
          <div class="iv-field iv-full">
            <label for="iv-name">Nome e cognome *</label>
            <input id="iv-name" name="name" required />
            <div class="iv-err"></div>
          </div>
          <div class="iv-field">
            <label for="iv-email">Email *</label>
            <input id="iv-email" name="email" type="email" required />
            <div class="iv-err"></div>
          </div>
          <div class="iv-field">
            <label for="iv-phone">Telefono *</label>
            <input id="iv-phone" name="phone" required />
            <div class="iv-err"></div>
          </div>
          <div class="iv-field iv-full">
            <label class="iv-check"><input id="iv-privacy" type="checkbox" name="privacy" required /><span>Accetto privacy *</span></label>
            <div class="iv-err"></div>
          </div>
        </div>
        <div class="iv-actions">
          <button type="button" class="iv-link iv-back">&larr; Indietro</button>
          <button type="submit" class="iv-btn">Invia richiesta</button>
          <span id="iv-status" class="iv-status"></span>
        </div>
      </div>

      <div class="iv-step" data-step="6" style="display:none;">
        <h3>Grazie! Richiesta inviata.</h3>
        <p><strong id="iv-thanks-fair">-</strong></p>
        <p><strong id="iv-thanks-range">-</strong></p>
        <div class="iv-actions"><button id="iv-new" type="button" class="iv-btn">Nuova valutazione</button></div>
      </div>
    </form>

    <aside class="iv-card" id="iv-card">
      <div class="iv-lock" id="iv-lock" style="display:none;">
        <div class="iv-lock-inner">
          <div class="iv-lock-title">Stima completa bloccata</div>
          <div class="iv-lock-text">Inserisci i contatti per sbloccare.</div>
        </div>
      </div>

      <div class="iv-card-top">
        <div class="iv-card-title">Stima in tempo reale</div>
        <div class="iv-badge" id="iv-badge">Indicativa</div>
      </div>

      <div class="iv-price iv-maskable">
        <div class="iv-price-main" id="iv-price-main">-</div>
        <div class="iv-price-range" id="iv-price-range">Compila i dati per vedere la stima</div>
      </div>

      <div class="iv-scenarios iv-maskable" id="iv-scenarios" style="display:none;">
        <div class="iv-scn"><div class="iv-scn-k">Vendita rapida</div><div class="iv-scn-v" id="iv-fast">-</div></div>
        <div class="iv-scn"><div class="iv-scn-k">Valore di mercato</div><div class="iv-scn-v" id="iv-fair">-</div></div>
        <div class="iv-scn"><div class="iv-scn-k">Miglior offerente</div><div class="iv-scn-v" id="iv-max">-</div></div>
      </div>

      <div class="iv-note">La stima visualizzata e una preview indicativa. Il valore finale viene affinato prima dell'invio.</div>
    </aside>
  </div>
</div>

<style>
  :root {
    --iv-text: #293133;
    --iv-muted: #6b7280;
    --iv-surface: #ffffff;
    --iv-line: #e5e7eb;
    --iv-brand: #C09866;
    --iv-brand-2: #ad8758;
    --iv-ok: #16a34a;
    --iv-err: #dc2626;
    --iv-radius: 18px;
    --iv-shadow: 0 12px 30px rgba(0, 0, 0, .06);
  }

  .iv-wrap {
    max-width: 1100px;
    margin: 36px auto;
    padding: 0 14px;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    color: var(--iv-text);
  }

  .iv-head { margin-bottom: 16px; }
  .iv-head h2 { margin: 0 0 6px; font-size: 30px; letter-spacing: -0.2px; }
  .iv-sub { margin: 0; color: var(--iv-muted); }

  .iv-layout { display: grid; grid-template-columns: 1.1fr .9fr; gap: 16px; align-items: start; }
  .iv-form, .iv-card { background: var(--iv-surface); border: 1px solid var(--iv-line); border-radius: var(--iv-radius); box-shadow: var(--iv-shadow); }
  .iv-form { padding: 18px; }
  .iv-card { padding: 18px; position: sticky; top: 104px; overflow: hidden; }

  .iv-progress { margin-bottom: 14px; }
  .iv-progress-top { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 8px; }
  .iv-progress-label { font-size: 13px; color: var(--iv-muted); }
  .iv-progress-hint { font-size: 13px; font-weight: 700; }
  .iv-progress-bar { height: 10px; background: #f8fafc; border-radius: 999px; overflow: hidden; border: 1px solid var(--iv-line); }
  .iv-progress-fill { height: 100%; width: 16.7%; background: linear-gradient(90deg, var(--iv-brand), var(--iv-brand-2)); transition: width .25s ease; }

  .iv-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 14px; }
  .iv-full { grid-column: 1/-1; }
  .iv-field { display: flex; flex-direction: column; }
  .iv-field label { font-size: 13px; font-weight: 700; margin-bottom: 6px; color: #374151; }

  .iv-field input, .iv-field textarea, .iv-field select {
    width: 100%; min-height: 44px; box-sizing: border-box;
    padding: 11px 12px; border-radius: 12px; border: 1px solid var(--iv-line);
    font-size: 15px; background: #fff; color: var(--iv-text);
    transition: border-color .15s ease, box-shadow .15s ease;
  }

  .iv-field textarea { min-height: 96px; resize: vertical; }
  .iv-field input:focus, .iv-field textarea:focus, .iv-field select:focus {
    outline: none; border-color: var(--iv-brand); box-shadow: 0 0 0 4px rgba(192, 152, 102, .16);
  }

  .iv-field input.iv-error, .iv-field textarea.iv-error, .iv-field select.iv-error { border-color: var(--iv-err); }
  .iv-err { min-height: 14px; font-size: 12px; color: var(--iv-err); margin-top: 4px; }

  .iv-checkrow { display: flex; flex-wrap: wrap; gap: 10px 14px; }
  .iv-check { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #4b5563; }
  .iv-check input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--iv-brand); }

  .iv-actions { margin-top: 16px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
  .iv-btn {
    border: none; border-radius: 999px; cursor: pointer;
    background: linear-gradient(90deg, var(--iv-brand), var(--iv-brand-2));
    color: #fff; font-size: 14px; font-weight: 800; padding: 11px 18px;
    box-shadow: 0 8px 20px rgba(192, 152, 102, .28);
  }

  .iv-link { border: none; background: none; color: #374151; text-decoration: underline; cursor: pointer; }
  .iv-status { font-size: 13px; }
  .iv-status.iv-ok { color: var(--iv-ok); }
  .iv-status.iv-bad { color: var(--iv-err); }

  .iv-card-top { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
  .iv-card-title { font-weight: 900; }
  .iv-badge {
    font-size: 12px; font-weight: 800; border-radius: 999px; padding: 5px 10px;
    border: 1px solid rgba(192, 152, 102, .35); color: #7a5a35; background: rgba(192, 152, 102, .12);
  }

  .iv-price { margin-top: 12px; }
  .iv-price-main { font-size: 32px; font-weight: 900; letter-spacing: -0.4px; }
  .iv-price-range { font-size: 13px; color: var(--iv-muted); margin-top: 4px; }

  .iv-scenarios { display: grid; gap: 8px; margin-top: 12px; }
  .iv-scn { display: flex; justify-content: space-between; gap: 8px; padding: 10px 12px; border: 1px solid var(--iv-line); border-radius: 12px; background: #f8fafc; }
  .iv-scn-k { font-size: 13px; color: var(--iv-muted); font-weight: 700; }
  .iv-scn-v { font-size: 13px; font-weight: 900; }
  .iv-note { margin-top: 12px; font-size: 12px; color: var(--iv-muted); line-height: 1.45; }

  .iv-price, .iv-scenarios, .iv-maskable { position: relative; overflow: hidden; border-radius: 12px; }
  .iv-card.iv-locked .iv-maskable {
    filter: blur(4px);
    opacity: .96;
    transform: translateZ(0);
    clip-path: inset(0 round 12px);
  }

  .iv-lock {
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(255, 255, 255, .45), rgba(255, 255, 255, .9));
    display: flex;
    align-items: flex-end;
    padding: 12px;
  }

  .iv-lock-inner {
    width: 100%;
    border: 1px solid rgba(192, 152, 102, .35);
    background: #fff;
    border-radius: 12px;
    padding: 10px 12px;
  }

  .iv-lock-title { font-size: 13px; font-weight: 900; }
  .iv-lock-text { font-size: 12px; color: var(--iv-muted); }

  @media (max-width: 980px) {
    .iv-layout { grid-template-columns: 1fr; }
    .iv-card { position: relative; top: auto; }
  }

  @media (max-width: 640px) {
    .iv-grid { grid-template-columns: 1fr; }
    .iv-head h2 { font-size: 26px; }
  }
</style>

<script src="/wp-content/themes/wpresidence/js/valuation-widget-ai.js" defer></script>
